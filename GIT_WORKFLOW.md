# Git Workflow Reference

A practical reference for working with git and GitHub on scientific repos — written for a solo researcher using AI CLI agents (Claude Code, Codex, Gemini CLI) who may onboard collaborators later.

This isn't a comprehensive git tutorial. It's a distilled set of decisions and practices for this repo that you can transfer to future projects.

---

## Repository Setup

**Fork model:** If this repo lives under an organization or collaborator's account, fork it to your own GitHub account. Your fork is `origin`; the original is `upstream`. If you own the repo outright, you just have `origin`.

**Visibility:** Public repos are fine for open science. If you have unpublished data or results you want to keep private until publication, use a private repo and flip it to public later.

**Clone once, work locally:**
```bash
git clone https://github.com/YOUR_USERNAME/repo-name.git
cd repo-name
```

---

## Branching Strategy

**`main` is the stable branch.** It should always contain working code. Don't commit directly to `main` — use feature branches and merge via pull requests.

**Feature branches** are where all work happens:
```bash
git checkout main
git pull origin main
git checkout -b descriptive-branch-name
```

Use descriptive names that say what the branch does:
- `add-learning-rate-sweep` — good
- `fix-efe-precision-bug` — good
- `test1` — less useful, but fine for throwaway experiments

**When you're done with a branch**, merge it into `main` via a PR (see below), then delete it. Branches are cheap — create them freely, clean them up after merging.

---

## The Pull Request (PR) Workflow

Even as a solo researcher, always merge into `main` through a pull request rather than pushing directly. Here's why:

1. **Review checkpoint.** The PR diff shows you exactly what changed. This is especially valuable when an AI agent wrote the code — you can review every line before it reaches `main`.
2. **Rollback safety.** Each PR is a discrete, revertable unit. If something breaks, you can revert the whole PR cleanly.
3. **History.** PR titles and descriptions become a readable changelog of what happened and why.

**Basic PR workflow:**
```bash
# Work on your branch, commit changes
git add file1.m file2.m
git commit -m "Add learning rate parameter sweep"
git push -u origin descriptive-branch-name

# Create PR on GitHub (or via CLI)
gh pr create --title "Add learning rate sweep" --body "Description of changes"
```

Review the PR on GitHub (or use `gh pr diff`), then merge it. The `gh` CLI tool makes this fast from the terminal.

---

## Commits and Pushes

**Commit often, push when ready.** A commit is a local save point. A push shares it with GitHub.

```bash
git add specific-file.m        # Stage specific files
git commit -m "Clear message"   # Commit locally
git push origin branch-name     # Push to GitHub
```

**Commit messages** should say *what* changed and *why*. Keep the first line under ~70 characters:
- `Fix off-by-one error in belief update loop` — good
- `Updated stuff` — less helpful

**Avoid `git add .` or `git add -A`** — these stage everything, including files you might not want tracked (data files, OS files, credentials). Stage files by name.

---

## .gitignore

The `.gitignore` file tells git which files to never track. This repo's `.gitignore` excludes:

- **`.mat` files** — MATLAB data files are often large and generated from scripts. Regenerate them rather than versioning them.
- **`.fig` files** — MATLAB figure files. Regenerate from scripts.
- **`.asv`, `*.m~`** — MATLAB autosave and backup files.
- **`.DS_Store`, `Thumbs.db`** — OS-generated metadata files that clutter repos.
- **SPM outputs** — neuroimaging files (`.nii`, `.hdr`, `.img`) generated by SPM.

If you have a specific data file that *must* be versioned, you can override the ignore with `git add -f filename.mat`, but think twice about whether it belongs in git (large files are better stored elsewhere).

---

## CLAUDE.md and AI Agent Context

`CLAUDE.md` is a project-level instruction file that AI CLI agents (Claude Code) read automatically when working in this repo. It tells the agent about:

- Project structure and dependencies
- Key parameters and conventions
- What files do what

This means when you ask the agent to modify code, it already understands the codebase context. Keep `CLAUDE.md` updated as the project evolves. Other AI agents (Codex, Gemini CLI) may use similar context files — the principle is the same.

---

## Worktrees (Optional, Advanced)

A **git worktree** lets you check out a second copy of the repo in a separate directory, on a different branch, without affecting your main working directory. This is useful when:

- You want to test something on a different branch without stashing your current work.
- An AI agent needs to work in isolation without touching your files.

```bash
# Create a worktree on a new branch
git worktree add ../my-experiment experiment-branch

# When done, remove it
git worktree remove ../my-experiment
```

You don't need worktrees for typical solo work. They become more useful when running multiple agents in parallel or switching context frequently.

---

## GitHub Actions (CI/CD)

**You don't need this yet.** GitHub Actions lets you run automated checks (tests, linting) whenever you push code or open a PR. It becomes relevant when:

- You add a test suite and want it to run automatically on every PR.
- You want to auto-generate documentation or validate code style.
- Collaborators join and you want to enforce quality checks before merging.

For now, manual review of PRs is sufficient. When the time comes, Actions are configured via YAML files in `.github/workflows/`.

---

## Quick Reference

| Task | Command |
|------|---------|
| Check status | `git status` |
| Create branch | `git checkout -b branch-name` |
| Stage files | `git add file1.m file2.m` |
| Commit | `git commit -m "message"` |
| Push branch | `git push -u origin branch-name` |
| Create PR | `gh pr create --title "..." --body "..."` |
| Switch branch | `git checkout branch-name` |
| Update from main | `git checkout main && git pull` |
| Delete merged branch | `git branch -d branch-name` |
